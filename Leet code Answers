175. Combine Two Tables

select firstname,lastname,city,state from person a left join address b on a.personid=b.personid

176. Second Highest Salary

select max(salary) as secondhighestsalary from employee a where salary<(select max(salary) from employee b);

177. Nth Highest Salary

CREATE FUNCTION getNthHighestSalary(N INT) RETURNS INT
BEGIN
  RETURN (select distinct(a.salary) as getNthhighestsalary from employee a where n-1=(select count(distinct(b.salary)) 
  from employee b where a.salary<b.salary));
END

178. Rank Scores

select score,dense_rank() over(order by score desc) 'rank' from scores;

180. Consecutive Numbers

select distinct num as consecutivenums from 
(select num, lead(num) over(order by id) as beforenumber,lag(num) over(order by id) as afternumber from logs) D 
where num=beforenumber and beforenumber=afternumber;

181. Employees Earning More Than Their Managers

select b.name as employee from employee a join employee b where a.id=b.managerid and a.salary<b.salary;

182. Duplicate Emails

select email from person group by email having count(email)>1;

183. Customers Who Never Order

select c.name as customers from customers c where id not in (select customerid from orders );

184. Department Highest Salary

select department,employee,salary from (select b.name as department,a.name as employee,salary,
dense_rank() over(partition by departmentid order by salary desc) 'rnk' from employee a join department b on a.departmentid=b.id) d where rnk=1;

185. Department Top Three Salaries

select department,employee,salary from (select b.name as department,a.name as employee,salary,dense_rank() 
over(partition by departmentid order by salary desc) 'rnk' from employee a join department b on a.departmentid=b.id) d where rnk in (1,2,3);

196. Delete Duplicate Emails

delete b from person a, person b where a.email=b.email and a.id<b.id;

197. Rising Temperature

select id from (select id,temperature,recorddate,lag(temperature,1) over(order by recorddate) as nextdaytemperature,
lag(recorddate,1) over() as nextdate from weather) d where nextdaytemperature<temperature and datediff(nextdate,recorddate)=-1;

511. Game Play Analysis I

select player_id,min(event_date) as first_login from activity group by player_id;

512. Game Play Analysis II

select player_id, device_id  from Activity where (player_id, event_date) in ( select player_id, min(event_date) from Activity group by player_id);
    
 534. Game Play Analysis III

select player_id,event_date,sum(games_played) over(partition by player_id order by event_date) as games_played_so_far from activity;

570. Managers with at Least 5 Direct Reports

select  b as name from (select distinct a.name as b,count(*) from employee a,employee b where a.id=b.managerid group by a.name having count(*)>=5) e;

574. Winning Candidate

select name from (select name,count(*) from candidate a join vote b on a.id=b.candidateid group by a.id order by count(*) desc limit 1) z;

577. Employee Bonus

select name,bonus from employee a left join bonus b on a.empid=b.empid where bonus<1000 or bonus is null;

580. Count Student Number in Departments

select dept_name,count(student_id) as student_number from department a 
left outer join student  b on a.dept_id=b.dept_id group by dept_name order by count(student_id) desc;

584. Find Customer Referee

select name from customer where referee_id!=2 or referee_id is null;

585. Investments in 2016


586. Customer Placing the Largest Number of Orders

select customer_number from orders group by customer_number order by count(order_number) desc limit 1;

595. Big Countries

select name,population,area from world where area>=3000000 or population>=25000000;

596. Classes More Than 5 Students

select class from courses group by class having count(student)>=5;

603. Consecutive Available Seats

select seat_id from (select seat_id,lag(free,1) over(order by seat_id asc) as new,free from cinema) a where new=free and free=1
union
select seat_id from (select seat_id,lead(free,1) over(order by seat_id asc) as new,free from cinema) a where new=free and free=1 order by seat_id asc ;

602. Friend Requests II: Who Has the Most Friends

select a as id,count(b) as num from (select accepter_id as a ,requester_id as b from RequestAccepted
union
select requester_id as a ,accepter_id as b from RequestAccepted) m  group by a order by num  desc limit 1; 

1369. Get the Second Most Recent Activity

select username,activity,startdate,enddate from (select username,activity,startdate,enddate,row_number() 
over(partition by username order by startdate desc) as a,count(*) over(partition by username) as d from UserActivity) a where a=2 or d=1;
